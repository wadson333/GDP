<!-- <div class="d-flex justify-content-center">
  <div class="col-8">
    @if (labTestCatalog(); as labTestCatalogRef) {
      <div>
        <h2 data-cy="labTestCatalogDetailsHeading"><span jhiTranslate="gdpApp.labTestCatalog.detail.title">Lab Test Catalog</span></h2>

        <hr />

        <jhi-alert-error></jhi-alert-error>

        <jhi-alert></jhi-alert>

        <dl class="row-md jh-entity-details">
          <dt><span jhiTranslate="global.field.id">ID</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.id }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.name">Name</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.name }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.unit">Unit</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.unit }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.description">Description</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.description }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.version">Version</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.version }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.validFrom">Valid From</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.validFrom | formatMediumDatetime }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.validTo">Valid To</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.validTo | formatMediumDatetime }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.method">Method</span></dt>
          <dd>
            <span [jhiTranslate]="'gdpApp.LabTestMethod.' + (labTestCatalogRef.method ?? 'null')">{{
              {
                null: '',
                COLORIMETRIC: 'COLORIMETRIC',
                PCR: 'PCR',
                SPECTROMETRY: 'SPECTROMETRY',
                MICROBIOLOGY: 'MICROBIOLOGY',
                IMMUNOASSAY: 'IMMUNOASSAY',
                OTHER: 'OTHER',
              }[labTestCatalogRef.method ?? 'null']
            }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.sampleType">Sample Type</span></dt>
          <dd>
            <span [jhiTranslate]="'gdpApp.SampleType.' + (labTestCatalogRef.sampleType ?? 'null')">{{
              {
                null: '',
                BLOOD: 'BLOOD',
                URINE: 'URINE',
                STOOL: 'STOOL',
                SALIVA: 'SALIVA',
                PLASMA: 'PLASMA',
                SERUM: 'SERUM',
                OTHER: 'OTHER',
              }[labTestCatalogRef.sampleType ?? 'null']
            }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.referenceRangeLow">Reference Range Low</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.referenceRangeLow }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.referenceRangeHigh">Reference Range High</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.referenceRangeHigh }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.active">Active</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.active }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.type">Type</span></dt>
          <dd>
            <span [jhiTranslate]="'gdpApp.LabTestType.' + (labTestCatalogRef.type ?? 'null')">{{
              {
                null: '',
                BIOCHEMISTRY: 'BIOCHEMISTRY',
                HEMATOLOGY: 'HEMATOLOGY',
                MICROBIOLOGY: 'MICROBIOLOGY',
                IMMUNOLOGY: 'IMMUNOLOGY',
                GENETIC: 'GENETIC',
                OTHER: 'OTHER',
              }[labTestCatalogRef.type ?? 'null']
            }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.loincCode">Loinc Code</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.loincCode }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.cost">Cost</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.cost }}</span>
          </dd>
          <dt><span jhiTranslate="gdpApp.labTestCatalog.turnaroundTime">Turnaround Time</span></dt>
          <dd>
            <span>{{ labTestCatalogRef.turnaroundTime }}</span>
          </dd>
        </dl>

        <button type="submit" (click)="previousState()" class="btn btn-info" data-cy="entityDetailsBackButton">
          <fa-icon icon="arrow-left"></fa-icon>&nbsp;<span jhiTranslate="entity.action.back">Retour</span>
        </button>

        <button type="button" [routerLink]="['/lab-test-catalog', labTestCatalogRef.id, 'edit']" class="btn btn-primary">
          <fa-icon icon="pencil-alt"></fa-icon>&nbsp;<span jhiTranslate="entity.action.edit">Editer</span>
        </button>
      </div>
    }
  </div>
</div> -->

<jhi-alert-error></jhi-alert-error>
<jhi-alert></jhi-alert>

@if (labTestCatalog; as labTestCatalogRef) {
  <div class="card surface-0">
    <div class="py-2 flex justify-end">
      <!-- Show these buttons only when editing -->
      @if (labTestCatalogRef.active) {
        <p-button
          icon="pi pi-power-off"
          severity="danger"
          [label]="'gdpApp.labTestCatalog.actions.deactivate' | translate"
          pTooltip="{{ 'gdpApp.labTestCatalog.deactivateTooltip' | translate }}"
          [text]="true"
          styleClass="mr-2"
          (click)="deactivate(labTestCatalogRef)"
        ></p-button>
      }
      @if (isLastversion(labTestCatalogRef)) {
        <p-button
          icon="pi pi-copy"
          severity="info"
          [label]="'gdpApp.labTestCatalog.actions.newVersion' | translate"
          pTooltip="{{ 'gdpApp.labTestCatalog.newVersionTooltip' | translate }}"
          [text]="true"
          class="mr-2"
          (click)="showNewVersionDialog(labTestCatalogRef)"
        ></p-button>
      }
    </div>
    <!-- <p-divider></p-divider> -->
    <!-- Tabs -->
    <p-tabView (activeIndexChange)="onTabChange($event)" [activeIndex]="activeTab()">
      <!-- Details Tab -->
      <p-tabPanel header="{{ 'gdpApp.labTestCatalog.detail.tabs.details' | translate }}">
        <!-- Main Content -->
        <!-- Header -->
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-base font-semibold m-0">
            <i class="pi pi-info-circle mr-2"></i>
            <span jhiTranslate="gdpApp.labTestCatalog.detail.section.general"></span>
          </h2>
          <p-tag [value]="'Version ' + labTestCatalogRef.version" severity="info"></p-tag>
        </div>

        <p-divider></p-divider>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Basic Information -->
          <div class="col-span-2 md:col-span-1">
            <div class="space-y-4">
              <div class="field">
                <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.name">Name</label>
                <div class="text-lg">{{ labTestCatalogRef.name }}</div>
              </div>

              <div class="field">
                <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.description">Description</label>
                <div class="text-base">{{ labTestCatalogRef.description }}</div>
              </div>

              <div class="field">
                <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.unit">Unit</label>
                <div class="text-base">{{ labTestCatalogRef.unit }}</div>
              </div>
            </div>
          </div>

          <!-- Technical Details -->
          <div class="col-span-2 md:col-span-1">
            <div class="space-y-4">
              <div class="field">
                <label class="block text-sm font-bold mb-1">Status</label>
                <p-chip
                  [label]="labTestCatalogRef.active ? 'Active' : 'Inactive'"
                  [styleClass]="labTestCatalogRef.active ? 'text-green-600' : 'text-red-600'"
                >
                </p-chip>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div class="field mr-2">
                  <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.method">Method</label>
                  <p-chip [label]="labTestCatalogRef.method || 'N/A'"></p-chip>
                </div>
                <div class="field">
                  <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.sampleType">Sample Type</label>
                  <p-chip [label]="labTestCatalogRef.sampleType || 'N/A'"></p-chip>
                </div>
              </div>
              <div class="field">
                <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.type">Type</label>
                <p-chip [label]="labTestCatalogRef.type || 'N/A'"></p-chip>
              </div>
            </div>
          </div>

          <!-- Reference Range -->
          <div class="col-span-2">
            <h2 class="text-base font-semibold m-0">
              <i class="pi pi-info-circle mr-2"></i>
              <span jhiTranslate="gdpApp.labTestCatalog.detail.section.reference"></span>
            </h2>
            <p-divider></p-divider>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="field">
                <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.referenceRangeLow"
                  >Reference Range Low</label
                >
                <div class="text-base">{{ labTestCatalogRef.referenceRangeLow }}</div>
              </div>
              <div class="field">
                <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.referenceRangeHigh"
                  >Reference Range High</label
                >
                <div class="text-base">{{ labTestCatalogRef.referenceRangeHigh }}</div>
              </div>
            </div>
          </div>

          <!-- Additional Information -->
          <div class="col-span-2">
            <h2 class="text-base font-semibold m-0">
              <i class="pi pi-info-circle mr-2 text-info"></i>
              <span jhiTranslate="gdpApp.labTestCatalog.detail.section.additional"></span>
            </h2>
            <p-divider></p-divider>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="field">
                <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.loincCode">LOINC Code</label>
                <div class="text-base">{{ labTestCatalogRef.loincCode || 'N/A' }}</div>
              </div>
              <div class="field">
                <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.cost">Cost</label>
                <div class="text-base">{{ labTestCatalogRef.cost }}</div>
              </div>
              <div class="field">
                <label class="block text-sm font-bold mb-1" jhiTranslate="gdpApp.labTestCatalog.turnaroundTime">Turnaround Time</label>
                <div class="text-base">{{ labTestCatalogRef.turnaroundTime }} min</div>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>

      <!-- History Tab -->
      <!-- History Tab -->
      <p-tabPanel header="{{ 'gdpApp.labTestCatalog.detail.tabs.history' | translate }}">
        <div class="relative">
          <!-- Loading Overlay -->
          <div *ngIf="loading()" class="absolute inset-0 flex items-center justify-center bg-surface-100/50">
            <p-progressSpinner strokeWidth="4"></p-progressSpinner>
          </div>

          <!-- Timeline -->
          <p-timeline [value]="versions" align="alternate" styleClass="mt-4">
            <ng-template pTemplate="marker" let-version>
              <span class="flex w-8 h-8 rounded-full items-center justify-center">
                {{ version.version }}
              </span>
            </ng-template>
            <ng-template pTemplate="content" let-version>
              <div class="card shadow-sm p-4 border-round">
                <div class="flex items-center mb-2">
                  @if (version.id == labTestCatalogRef.id) {
                    <i class="pi pi-eye mr-1 text-blue-400"></i>
                    <!-- <p-chip label="" icon="pi pi-eye" [styleClass]="'m-0 px-1bg-transparent text-blue-400'"></p-chip> -->
                  }
                  <h5 class="mr-1">{{ version.name }}</h5>
                  <p-tag
                    [value]="(version.active ? 'gdpApp.labTestCatalog.actif' : 'gdpApp.labTestCatalog.inactif') | translate"
                    [severity]="version.active ? 'success' : 'warning'"
                  >
                  </p-tag>
                </div>
                <div class="text-sm text-surface-600">
                  <div class="mb-2">
                    <i class="pi pi-calendar mr-1"></i>
                    <span class="font-semibold mr-2" jhiTranslate="gdpApp.labTestCatalog.validFrom">validFrom:</span> :
                    {{ version.validFrom | date: 'medium' }}
                  </div>
                  <div class="mb-2" *ngIf="version.description">
                    <i class="pi pi-info-circle mr-1"></i>
                    <span class="font-semibold mr-2" jhiTranslate="gdpApp.labTestCatalog.description">description:</span> :
                    {{ version.description }}
                  </div>

                  <div class="mb-2">
                    <i class="pi pi-tag mr-1"></i>
                    <span class="font-semibold mr-2" jhiTranslate="gdpApp.labTestCatalog.type">type:</span> :
                    {{ version.type }}
                  </div>

                  <div class="">
                    <i class="pi pi-cog mr-1"></i>
                    <span class="font-semibold mr-2" jhiTranslate="gdpApp.labTestCatalog.method">method:</span>
                    {{ version.method }}
                  </div>
                </div>
              </div>
            </ng-template>
          </p-timeline>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
}

@if (labTestCatalog && isLastversion(labTestCatalog)) {
  <p-dialog
    *ngIf="displayFormDialog"
    [header]="'gdpApp.labTestCatalog.newVersion.title' | translate: { name: labTestCatalog.name }"
    [(visible)]="displayFormDialog"
    [modal]="true"
    [style]="{ width: '80vw', maxWidth: '900px' }"
    [draggable]="false"
    (onHide)="onDialogHide()"
  >
    <jhi-lab-test-catalog-update
      [labTestCatalog]="labTestCatalog"
      (saveNewLabVersionEvent)="onDialogHide($event)"
      [isRenew]="true"
      (closeEvent)="onDialogHide()"
    ></jhi-lab-test-catalog-update>
  </p-dialog>
}
