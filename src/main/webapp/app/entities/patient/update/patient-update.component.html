<jhi-alert-error></jhi-alert-error>
<!-- <p-confirmDialog></p-confirmDialog> -->
<jhi-alert></jhi-alert>
<div class="patient-form-container">
  <form name="editForm" novalidate (ngSubmit)="save()" [formGroup]="editForm">
    <!-- Required fields notice -->
    <div class="text-sm text-surface-600 mb-4">
      <i class="pi pi-info-circle mr-1"></i>
      {{ 'gdpApp.patient.confirmation.required' | translate }}
    </div>

    <!-- Loading Overlay -->
    <div *ngIf="isSaving" class="absolute inset-0 bg-black/50 flex items-center justify-center z-50">
      <p-progressSpinner strokeWidth="4" />
    </div>
    <!-- Stepper -->
    <p-stepper [(activeStep)]="currentStep" [linear]="true" styleClass="mb-3">
      <p-stepperPanel [header]="'gdpApp.patient.wizard.steps.userInfo' | translate">
        <ng-template pTemplate="content" let-nextCallback="nextCallback">
          <div class="step-content">
            <!-- User Information Section -->
            <div class="section-header">
              <h3 class="text-xl font-semibold section-title">
                <span> {{ 'gdpApp.patient.form.userSection.title' | translate }}</span>
                <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.userSection.subtitle' | translate">
                  <i class="pi pi-info-circle text-lg"></i>
                </span>
              </h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-x-3 gap-y-2 mt-2">
              <!-- Login -->
              <div class="field">
                <label for="login" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.login' | translate }}
                  <span class="text-red-500">*</span>
                  <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.userSection.subtitle' | translate">
                    <i class="pi pi-info-circle text-lg"></i>
                  </span>
                </label>
                <input
                  pInputText
                  id="login"
                  formControlName="login"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('login') }"
                  [placeholder]="'gdpApp.patient.login' | translate"
                />
                <!-- <small class="block mt-1 ">
                  {{ 'gdpApp.patient.form.userSection.loginHelp' | translate }}
                </small> -->
                <small *ngIf="hasFieldError('login')" class="p-error block mt-1">
                  {{ getFieldError('login') }}
                </small>
              </div>

              <!-- Email -->
              <div class="field">
                <label for="email" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.email' | translate }}
                  <span class="text-red-500">*</span>
                  <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.userSection.emailHelp' | translate">
                    <i class="pi pi-info-circle text-lg"></i>
                  </span>
                </label>
                <input
                  pInputText
                  type="email"
                  id="email"
                  formControlName="email"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('email') }"
                  [placeholder]="'gdpApp.patient.email' | translate"
                />
                <!-- <small class="block mt-1 ">
                  {{ 'gdpApp.patient.form.userSection.emailHelp' | translate }}
                </small> -->
                <small *ngIf="hasFieldError('email')" class="p-error block mt-1">
                  {{ getFieldError('email') }}
                </small>
              </div>

              <!-- Language Key -->
              <div class="field">
                <label for="langKey" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.langKey' | translate }}
                  <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.userSection.langKeyHelp' | translate">
                    <i class="pi pi-info-circle text-lg"></i>
                  </span>
                </label>
                <p-dropdown
                  id="langKey"
                  formControlName="langKey"
                  [options]="[
                    { label: 'English', value: 'en' },
                    { label: 'FranÃ§ais', value: 'fr' },
                  ]"
                  optionLabel="label"
                  optionValue="value"
                  [placeholder]="'gdpApp.patient.langKey' | translate"
                  styleClass="w-full"
                ></p-dropdown>
                <!-- <small class="block mt-1 ">
                  {{ 'gdpApp.patient.form.userSection.langKeyHelp' | translate }}
                </small> -->
              </div>
            </div>

            <!-- Patient Basic Info Section -->
            <div class="section-header mt-4">
              <h3 class="text-xl font-semibold text-primary-700">
                <span>{{ 'gdpApp.patient.form.patientSection.title' | translate }}</span>
                <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.patientSection.subtitle' | translate">
                  <i class="pi pi-info-circle text-lg"></i>
                </span>
              </h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-3 gap-y-2 mt-4">
              <!-- First Name -->
              <div class="field">
                <label for="firstName" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.firstName' | translate }}
                  <span class="text-red-500">*</span>
                </label>
                <input
                  pInputText
                  id="firstName"
                  formControlName="firstName"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('firstName') }"
                  [placeholder]="'gdpApp.patient.firstName' | translate"
                />
                <small *ngIf="hasFieldError('firstName')" class="p-error block mt-1">
                  {{ getFieldError('firstName') }}
                </small>
              </div>

              <!-- Last Name -->
              <div class="field">
                <label for="lastName" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.lastName' | translate }}
                  <span class="text-red-500">*</span>
                </label>
                <input
                  pInputText
                  id="lastName"
                  formControlName="lastName"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('lastName') }"
                  [placeholder]="'gdpApp.patient.lastName' | translate"
                />
                <small *ngIf="hasFieldError('lastName')" class="p-error block mt-1">
                  {{ getFieldError('lastName') }}
                </small>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
              <!-- Birth Date -->
              <div class="field">
                <label for="birthDate" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.birthDate' | translate }}
                  <span class="text-red-500">*</span>
                </label>
                <p-calendar
                  id="birthDate"
                  formControlName="birthDate"
                  dateFormat="yy-mm-dd"
                  [showIcon]="true"
                  [maxDate]="today"
                  [placeholder]="'gdpApp.patient.birthDate' | translate"
                  styleClass="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('birthDate') }"
                ></p-calendar>
                <small *ngIf="hasFieldError('birthDate')" class="p-error block mt-1">
                  {{ getFieldError('birthDate') }}
                </small>
              </div>

              <!-- Gender -->
              <div class="field">
                <label for="gender" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.gender' | translate }}
                </label>
                <p-dropdown
                  id="gender"
                  formControlName="gender"
                  [options]="genderOptions"
                  optionLabel="label"
                  optionValue="value"
                  [placeholder]="'gdpApp.patient.gender' | translate"
                  styleClass="w-full"
                >
                </p-dropdown>
              </div>

              <!-- Blood Type -->
              <div class="field">
                <label for="bloodType" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.bloodType' | translate }}
                </label>
                <p-dropdown
                  id="bloodType"
                  formControlName="bloodType"
                  [options]="blodTypeOptions"
                  optionLabel="label"
                  optionValue="value"
                  [placeholder]="'gdpApp.patient.bloodType' | translate"
                  styleClass="w-full"
                >
                </p-dropdown>
              </div>
            </div>

            <!-- Activation Flags -->
            <p-divider></p-divider>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="field-checkbox">
                <p-checkbox formControlName="sendActivationEmail" [binary]="true" inputId="sendActivationEmail"></p-checkbox>
                <label for="sendActivationEmail" class="ml-2">
                  <span>{{ 'gdpApp.patient.form.flags.sendActivationEmail' | translate }}</span>
                  <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.flags.sendActivationEmailHelp' | translate">
                    <i class="pi pi-info-circle text-lg"></i>
                  </span>
                </label>
                <!-- <small class="block mt-1 ml-7">
                  {{ 'gdpApp.patient.form.flags.sendActivationEmailHelp' | translate }}
                </small> -->
              </div>

              <div class="field-checkbox">
                <p-checkbox formControlName="activatedOnCreate" [binary]="true" inputId="activatedOnCreate"></p-checkbox>
                <label for="activatedOnCreate" class="ml-2">
                  <span>{{ 'gdpApp.patient.form.flags.activatedOnCreate' | translate }}</span>
                  <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.flags.activatedOnCreateHelp' | translate">
                    <i class="pi pi-info-circle text-lg"></i>
                  </span>
                </label>
                <!-- <small class="block mt-1 ml-7">
                  {{ 'gdpApp.patient.form.flags.activatedOnCreateHelp' | translate }}
                </small> -->
              </div>
            </div>

            <div class="flex justify-end mt-6">
              <p-button
                [label]="'gdpApp.patient.wizard.navigation.next' | translate"
                icon="pi pi-arrow-right"
                iconPos="right"
                severity="primary"
                (onClick)="nextStep()"
                [disabled]="!isStepValid(0)"
              ></p-button>
            </div>
          </div>
        </ng-template>
      </p-stepperPanel>

      <!-- <p-stepperPanel [header]="'gdpApp.patient.wizard.steps.patientBasic' | translate">
        <ng-template pTemplate="content">
          <div class="step-content">
            

            <div class="flex justify-between mt-6">
              <p-button
                [label]="'gdpApp.patient.wizard.navigation.previous' | translate"
                icon="pi pi-arrow-left"
                (onClick)="previousStep()"
                styleClass="p-button-secondary"
              ></p-button>
              <p-button
                [label]="'gdpApp.patient.wizard.navigation.next' | translate"
                icon="pi pi-arrow-right"
                iconPos="right"
                (onClick)="nextStep()"
                [disabled]="!isStepValid(1)"
              ></p-button>
            </div>
          </div>
        </ng-template>
      </p-stepperPanel> -->

      <p-stepperPanel [header]="'gdpApp.patient.wizard.steps.contactIdentity' | translate">
        <ng-template pTemplate="content">
          <div class="step-content">
            <!-- Contact & Identity Section -->
            <div class="section-header mb-4">
              <h3 class="text-xl font-semibold">
                {{ 'gdpApp.patient.form.contactSection.title' | translate }}
                <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.contactSection.subtitle' | translate">
                  <i class="pi pi-info-circle text-lg"></i>
                </span>
              </h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-y-2 gap-x-4">
              <!-- Phone 1 -->
              <div class="field">
                <label for="phone1" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.phone1' | translate }}
                  <span class="text-red-500">*</span>
                </label>
                <input
                  pInputText
                  id="phone1"
                  formControlName="phone1"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('phone1') }"
                  placeholder="+33612345678"
                />
                <small *ngIf="hasFieldError('phone1')" class="p-error block mt-1">
                  {{ getFieldError('phone1') }}
                </small>
              </div>

              <!-- Phone 2 -->
              <div class="field">
                <label for="phone2" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.phone2' | translate }}
                </label>
                <input
                  pInputText
                  id="phone2"
                  formControlName="phone2"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('phone2') }"
                  placeholder="+33612345678"
                />
                <small *ngIf="hasFieldError('phone2')" class="p-error block mt-1">
                  {{ getFieldError('phone2') }}
                </small>
              </div>

              <!-- Address -->
              <div class="field md:col-span-2">
                <label for="address" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.address' | translate }}
                </label>
                <textarea
                  pInputTextarea
                  id="address"
                  formControlName="address"
                  rows="3"
                  class="w-full"
                  [placeholder]="'gdpApp.patient.address' | translate"
                ></textarea>
              </div>
            </div>

            <p-divider></p-divider>

            <!-- Identity Documents Section -->
            <div class="section-header mb-4">
              <h3 class="text-xl font-semibold text-primary-700">
                {{ 'gdpApp.patient.form.identitySection.title' | translate }}
                <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.identitySection.subtitle' | translate">
                  <i class="pi pi-info-circle text-lg"></i>
                </span>
              </h3>
              <!-- <p class="text-sm  mt-1">
                {{ 'gdpApp.patient.form.identitySection.subtitle' | translate }}
              </p> -->
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-2">
              <!-- NIF -->
              <div class="field">
                <label for="nif" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.nif' | translate }}
                </label>
                <input
                  pInputText
                  id="nif"
                  formControlName="nif"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('nif') }"
                  [placeholder]="'gdpApp.patient.nif' | translate"
                  maxlength="10"
                />
                <small *ngIf="hasFieldError('nif')" class="p-error block mt-1">
                  {{ getFieldError('nif') }}
                </small>
              </div>

              <!-- NINU -->
              <div class="field">
                <label for="ninu" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.ninu' | translate }}
                </label>
                <input
                  pInputText
                  id="ninu"
                  formControlName="ninu"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('ninu') }"
                  [placeholder]="'gdpApp.patient.ninu' | translate"
                  maxlength="10"
                />
                <small *ngIf="hasFieldError('ninu')" class="p-error block mt-1">
                  {{ getFieldError('ninu') }}
                </small>
              </div>

              <!-- Passport Number -->
              <div class="field">
                <label for="passportNumber" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.passportNumber' | translate }}
                </label>
                <input
                  pInputText
                  id="passportNumber"
                  formControlName="passportNumber"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('passportNumber') }"
                  [placeholder]="'gdpApp.patient.passportNumber' | translate"
                  maxlength="15"
                />
                <small *ngIf="hasFieldError('passportNumber')" class="p-error block mt-1">
                  {{ getFieldError('passportNumber') }}
                </small>
              </div>
            </div>

            <p-divider></p-divider>

            <!-- Emergency Contact Section -->
            <div class="section-header mb-4">
              <h3 class="text-xl font-semibold text-primary-700">
                {{ 'gdpApp.patient.form.emergencySection.title' | translate }}
                <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.emergencySection.subtitle' | translate">
                  <i class="pi pi-info-circle text-lg"></i>
                </span>
              </h3>
              <!-- <p class="text-sm  mt-1">
                {{ 'gdpApp.patient.form.emergencySection.subtitle' | translate }}
              </p> -->
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Contact Person Name -->
              <div class="field">
                <label for="contactPersonName" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.contactPersonName' | translate }}
                </label>
                <input
                  pInputText
                  id="contactPersonName"
                  formControlName="contactPersonName"
                  class="w-full"
                  [placeholder]="'gdpApp.patient.contactPersonName' | translate"
                />
              </div>

              <!-- Contact Person Phone -->
              <div class="field">
                <label for="contactPersonPhone" class="block text-sm font-mediummb-2">
                  {{ 'gdpApp.patient.contactPersonPhone' | translate }}
                </label>
                <input
                  pInputText
                  id="contactPersonPhone"
                  formControlName="contactPersonPhone"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('contactPersonPhone') }"
                  placeholder="+33612345678"
                />
                <small *ngIf="hasFieldError('contactPersonPhone')" class="p-error block mt-1">
                  {{ getFieldError('contactPersonPhone') }}
                </small>
              </div>
            </div>

            <div class="flex justify-between mt-6">
              <p-button
                [label]="'gdpApp.patient.wizard.navigation.previous' | translate"
                icon="pi pi-arrow-left"
                severity="secondary"
                (onClick)="previousStep()"
              ></p-button>
              <p-button
                [label]="'gdpApp.patient.wizard.navigation.next' | translate"
                icon="pi pi-arrow-right"
                iconPos="right"
                severity="primary"
                (onClick)="nextStep()"
                [disabled]="!isStepValid(2)"
              ></p-button>
            </div>
          </div>
        </ng-template>
      </p-stepperPanel>

      <p-stepperPanel [header]="'gdpApp.patient.wizard.steps.medicalInfo' | translate">
        <ng-template pTemplate="content">
          <div class="step-content">
            <!-- Medical Information Section -->
            <div class="section-header mb-4">
              <h3 class="text-xl font-semibold">
                {{ 'gdpApp.patient.form.medicalSection.title' | translate }}
                <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.medicalSection.subtitle' | translate">
                  <i class="pi pi-info-circle text-lg"></i>
                </span>
              </h3>
              <!-- <p class="text-sm text-gray-600 mt-1">
                {{ 'gdpApp.patient.form.medicalSection.subtitle' | translate }}
              </p> -->
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-2">
              <!-- Height -->
              <div class="field">
                <label for="heightCm" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.heightCm' | translate }}
                </label>
                <p-inputNumber
                  id="heightCm"
                  formControlName="heightCm"
                  [min]="0"
                  [max]="300"
                  suffix=" cm"
                  [placeholder]="'gdpApp.patient.heightCm' | translate"
                  styleClass="w-full"
                ></p-inputNumber>
              </div>

              <!-- Weight -->
              <div class="field">
                <label for="weightKg" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.weightKg' | translate }}
                </label>
                <p-inputNumber
                  id="weightKg"
                  formControlName="weightKg"
                  [min]="0"
                  [max]="500"
                  [minFractionDigits]="1"
                  [maxFractionDigits]="2"
                  suffix=" kg"
                  [placeholder]="'gdpApp.patient.weightKg' | translate"
                  styleClass="w-full"
                ></p-inputNumber>
              </div>

              <!-- Smoking Status -->
              <div class="field">
                <label for="smokingStatus" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.smokingStatus' | translate }}
                </label>
                <p-dropdown
                  id="smokingStatus"
                  formControlName="smokingStatus"
                  optionLabel="label"
                  optionValue="value"
                  [options]="smokingStatusOptions"
                  [placeholder]="'gdpApp.patient.smokingStatus' | translate"
                  styleClass="w-full"
                >
                  <!-- <ng-template let-option pTemplate="item">
                    {{ 'gdpApp.patient.enumValues.smokingStatus.' + option | translate }}
                  </ng-template>
                  <ng-template let-selectedOption pTemplate="selectedItem">
                    {{ 'gdpApp.patient.enumValues.smokingStatus.' + selectedOption | translate }}
                  </ng-template> -->
                </p-dropdown>
              </div>

              <!-- Antecedents -->
              <div class="field md:col-span-3">
                <label for="antecedents" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.antecedents' | translate }}
                </label>
                <textarea
                  pInputTextarea
                  id="antecedents"
                  formControlName="antecedents"
                  rows="3"
                  class="w-full"
                  [placeholder]="'gdpApp.patient.antecedents' | translate"
                ></textarea>
              </div>

              <!-- Allergies -->
              <div class="field md:col-span-3">
                <label for="allergies" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.allergies' | translate }}
                </label>
                <textarea
                  pInputTextarea
                  id="allergies"
                  formControlName="allergies"
                  rows="3"
                  class="w-full"
                  [placeholder]="'gdpApp.patient.allergies' | translate"
                ></textarea>
              </div>

              <!-- Clinical Notes -->
              <div class="field md:col-span-3">
                <label for="clinicalNotes" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.clinicalNotes' | translate }}
                </label>
                <textarea
                  pInputTextarea
                  id="clinicalNotes"
                  formControlName="clinicalNotes"
                  rows="4"
                  class="w-full"
                  [placeholder]="'gdpApp.patient.clinicalNotes' | translate"
                ></textarea>
              </div>
            </div>

            <div class="flex justify-between mt-4">
              <p-button
                [label]="'gdpApp.patient.wizard.navigation.previous' | translate"
                icon="pi pi-arrow-left"
                severity="secondary"
                (onClick)="previousStep()"
                styleClass="p-button-secondary"
              ></p-button>
              <p-button
                [label]="'gdpApp.patient.wizard.navigation.next' | translate"
                icon="pi pi-arrow-right"
                iconPos="right"
                severity="primary"
                (onClick)="nextStep()"
                [disabled]="!isStepValid(3)"
              ></p-button>
            </div>
          </div>
        </ng-template>
      </p-stepperPanel>

      <p-stepperPanel [header]="'gdpApp.patient.wizard.steps.insurance' | translate">
        <ng-template pTemplate="content">
          <div class="step-content">
            <!-- Insurance Section -->
            <div class="section-header mb-4">
              <h3 class="text-xl font-semibold">
                {{ 'gdpApp.patient.form.insuranceSection.title' | translate }}
                <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.insuranceSection.subtitle' | translate">
                  <i class="pi pi-info-circle text-lg"></i>
                </span>
              </h3>
              <!-- <p class="text-sm mt-1">
                {{ 'gdpApp.patient.form.insuranceSection.subtitle' | translate }}
              </p> -->
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-2">
              <!-- Insurance Company Name -->
              <div class="field">
                <label for="insuranceCompanyName" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.insuranceCompanyName' | translate }}
                </label>
                <input
                  pInputText
                  id="insuranceCompanyName"
                  formControlName="insuranceCompanyName"
                  class="w-full"
                  [placeholder]="'gdpApp.patient.insuranceCompanyName' | translate"
                />
              </div>

              <!-- Patient Insurance ID -->
              <div class="field">
                <label for="patientInsuranceId" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.patientInsuranceId' | translate }}
                </label>
                <input
                  pInputText
                  id="patientInsuranceId"
                  formControlName="patientInsuranceId"
                  class="w-full"
                  [ngClass]="{ 'ng-invalid ng-dirty': hasFieldError('patientInsuranceId') }"
                  [placeholder]="'gdpApp.patient.patientInsuranceId' | translate"
                />
                <small *ngIf="hasFieldError('patientInsuranceId')" class="p-error block mt-1">
                  {{ getFieldError('patientInsuranceId') }}
                </small>
              </div>

              <!-- Insurance Policy Number -->
              <div class="field">
                <label for="insurancePolicyNumber" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.insurancePolicyNumber' | translate }}
                </label>
                <input
                  pInputText
                  id="insurancePolicyNumber"
                  formControlName="insurancePolicyNumber"
                  class="w-full"
                  [placeholder]="'gdpApp.patient.insurancePolicyNumber' | translate"
                />
              </div>

              <!-- Insurance Coverage Type -->
              <div class="field">
                <label for="insuranceCoverageType" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.insuranceCoverageType' | translate }}
                </label>
                <input
                  pInputText
                  id="insuranceCoverageType"
                  formControlName="insuranceCoverageType"
                  class="w-full"
                  [placeholder]="'gdpApp.patient.insuranceCoverageType' | translate"
                />
              </div>

              <!-- Insurance Valid From -->
              <div class="field">
                <label for="insuranceValidFrom" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.insuranceValidFrom' | translate }}
                </label>
                <p-calendar
                  id="insuranceValidFrom"
                  formControlName="insuranceValidFrom"
                  dateFormat="yy-mm-dd"
                  [showIcon]="true"
                  [placeholder]="'gdpApp.patient.insuranceValidFrom' | translate"
                  styleClass="w-full"
                ></p-calendar>
              </div>

              <!-- Insurance Valid To -->
              <div class="field">
                <label for="insuranceValidTo" class="block text-sm font-medium mb-2">
                  {{ 'gdpApp.patient.insuranceValidTo' | translate }}
                </label>
                <p-calendar
                  id="insuranceValidTo"
                  formControlName="insuranceValidTo"
                  dateFormat="yy-mm-dd"
                  [showIcon]="true"
                  [placeholder]="'gdpApp.patient.insuranceValidTo' | translate"
                  styleClass="w-full"
                ></p-calendar>
              </div>
            </div>

            <div class="flex justify-between mt-4">
              <p-button
                [label]="'gdpApp.patient.wizard.navigation.previous' | translate"
                icon="pi pi-arrow-left"
                severity="secondary"
                (onClick)="previousStep()"
                styleClass="p-button-secondary"
              ></p-button>
              <p-button
                [label]="'gdpApp.patient.wizard.navigation.next' | translate"
                icon="pi pi-arrow-right"
                severity="primary"
                iconPos="right"
                (onClick)="nextStep()"
                [disabled]="!isStepValid(4)"
              ></p-button>
            </div>
          </div>
        </ng-template>
      </p-stepperPanel>

      <p-stepperPanel [header]="'gdpApp.patient.wizard.steps.review' | translate">
        <ng-template pTemplate="content">
          <div class="step-content">
            <!-- Review Section -->
            <div class="section-header mb-4">
              <h3 class="text-xl font-semibold">
                {{ 'gdpApp.patient.form.reviewSection.title' | translate }}
                <span class="ml-2 sub-title" [pTooltip]="'gdpApp.patient.form.reviewSection.subtitle' | translate">
                  <i class="pi pi-info-circle text-lg"></i>
                </span>
              </h3>
              <!-- <p class="text-sm mt-1">
                {{ 'gdpApp.patient.form.reviewSection.subtitle' | translate }}
              </p> -->
            </div>

            <!-- Review Summary -->
            <div class="review-summary space-y-4">
              <!-- User Information Review -->
              <div class="review-section px-4 py-2 rounded-lg">
                <h4 class="text-lg font-semibold mb-3">
                  {{ 'gdpApp.patient.form.userSection.title' | translate }}
                </h4>
                <div class="grid grid-cols-2 gap-2">
                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.login' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">{{ editForm.get('login')?.value || '-' }}</span>
                  </div>
                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.email' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">{{ editForm.get('email')?.value || '-' }}</span>
                  </div>
                </div>
              </div>

              <!-- Patient Basic Info Review -->
              <div class="review-section px-4 py-2 rounded-lg">
                <h4 class="text-lg font-semibold mb-3">
                  {{ 'gdpApp.patient.form.patientSection.title' | translate }}
                </h4>
                <div class="grid grid-cols-2 gap-2">
                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.firstName' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">{{ editForm.get('firstName')?.value || '-' }}</span>
                  </div>
                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.lastName' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">{{ editForm.get('lastName')?.value || '-' }}</span>
                  </div>

                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.birthDate' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">
                      {{ (editForm.get('birthDate')?.value | date: 'dd/MM/yyyy') || '-' }}
                    </span>
                  </div>

                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.gender' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">
                      {{ getGenderLabel() }}
                    </span>
                  </div>
                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.bloodType' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">
                      {{ getBloodTypeLabel() }}
                    </span>
                  </div>
                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.smokingStatus' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">
                      {{ getSmokingStatusLabel() }}
                    </span>
                  </div>

                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.heightCm' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">
                      {{ editForm.get('heightCm')?.value || '-' }}
                    </span>
                  </div>

                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.weightKg' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">
                      {{ editForm.get('weightKg')?.value || '-' }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Contact Information Review -->
              <div class="review-section px-4 py-2 rounded-lg">
                <h4 class="text-lg font-semibold mb-3">
                  {{ 'gdpApp.patient.form.contactSection.title' | translate }}
                </h4>
                <div class="grid grid-cols-2 gap-2">
                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.phone1' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">{{ editForm.get('phone1')?.value || '-' }}</span>
                  </div>
                  <div class="text-sm">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.phone2' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">{{ editForm.get('phone2')?.value || '-' }}</span>
                  </div>
                  <div class="text-sm col-span-2">
                    <span class="font-medium" style="color: var(--surface-500)">{{ 'gdpApp.patient.address' | translate }}:</span>
                    <span class="ml-2" style="color: var(--surface-700)">{{ editForm.get('address')?.value || '-' }}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="flex justify-between mt-6">
              <p-button
                [label]="'gdpApp.patient.wizard.navigation.previous' | translate"
                icon="pi pi-arrow-left"
                (onClick)="previousStep()"
                styleClass="p-button-secondary"
              ></p-button>
              <p-button
                type="submit"
                [label]="'gdpApp.patient.wizard.navigation.save' | translate"
                icon="pi pi-save"
                [loading]="isSaving"
                [disabled]="editForm.invalid || isSaving"
                styleClass="p-button-success"
              ></p-button>
            </div>
          </div>
        </ng-template>
      </p-stepperPanel>
    </p-stepper>
  </form>
</div>
